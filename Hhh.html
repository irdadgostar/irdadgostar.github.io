<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>برنامه ریزی هفتگی پیشرفته</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --light-bg: #f8f9fa;
            --border-color: #ddd;
        }

        body {
            font-family: 'Tahoma', 'Segoe UI', Arial, sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* --- کنترل پنل (ورودی ها) --- */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: end;
            border-top: 5px solid var(--accent-color);
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }

        input, select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-add { background-color: var(--accent-color); color: white; }
        .btn-add:hover { background-color: #2980b9; }

        .btn-print { background-color: var(--primary-color); color: white; margin-right: auto; }
        .btn-clear { background-color: #e74c3c; color: white; }

        /* --- ساختار برنامه --- */
        .planner-container {
            display: flex;
            flex-wrap: nowrap; /* در وب اسکرول افقی بخورد */
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 20px;
        }

        .day-column {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            min-width: 200px;
            flex: 0 0 200px;
            display: flex;
            flex-direction: column;
        }

        .day-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .slots-container {
            flex-grow: 1;
        }

        .time-slot {
            display: flex;
            border-bottom: 1px solid #eee;
            height: 24px; /* ارتفاع هر ربع ساعت */
            font-size: 11px;
            position: relative;
        }

        .time-label {
            width: 45px;
            background-color: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 1px solid #ddd;
            color: #666;
            font-size: 10px;
        }

        .task-area {
            flex-grow: 1;
            padding: 0 5px;
            display: flex;
            align-items: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: background 0.2s;
        }

        .task-area:hover {
            background-color: #fafafa;
        }

        /* استایل تسک‌های ثبت شده */
        .filled-task {
            background-color: #e3f2fd;
            border-left: 3px solid var(--accent-color);
            color: #000;
            font-size: 11px;
        }

        .task-start {
            border-top: 1px solid #bbdefb;
        }

        /* --- تنظیمات پرینت (A4) --- */
        @media print {
            @page {
                size: A4;
                margin: 10mm;
            }

            body {
                background: white;
                padding: 0;
            }

            .controls, .no-print {
                display: none !important;
            }

            .planner-container {
                display: block; /* تغییر از فلکس به بلاک برای کنترل بهتر */
                overflow: visible;
            }

            .day-column {
                width: 48%; /* دو روز در کنار هم */
                float: right; 
                margin-bottom: 15px;
                margin-left: 1%;
                min-width: unset;
                border: 1px solid #000;
                page-break-inside: avoid; /* جلوگیری از شکستن وسط روز */
                box-shadow: none;
                border-radius: 0;
            }
            
            /* تمیز کردن float ها */
            .planner-container::after {
                content: "";
                clear: both;
                display: table;
            }

            .day-header {
                background-color: #ddd !important;
                color: black !important;
                border-bottom: 1px solid #000;
                border-radius: 0;
            }

            .time-slot {
                height: 18px; /* کمی فشرده‌تر برای پرینت */
                border-bottom: 1px solid #ccc;
            }

            .time-label {
                background-color: #fff !important;
                border-left: 1px solid #000;
                color: #000;
                font-weight: bold;
            }

            .filled-task {
                background-color: #eee !important; /* رنگ خاکستری برای پرینت */
                border-left: 3px solid #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>

    <!-- بخش کنترل و ورودی‌ها -->
    <div class="controls no-print">
        <div class="input-group">
            <label>عنوان فعالیت</label>
            <input type="text" id="taskName" placeholder="مثلاً: مطالعه زبان">
        </div>

        <div class="input-group">
            <label>روز هفته</label>
            <select id="daySelect">
                <option value="saturday">شنبه</option>
                <option value="sunday">یکشنبه</option>
                <option value="monday">دوشنبه</option>
                <option value="tuesday">سه‌شنبه</option>
                <option value="wednesday">چهارشنبه</option>
                <option value="thursday">پنج‌شنبه</option>
                <option value="friday">جمعه</option>
            </select>
        </div>

        <div class="input-group">
            <label>ساعت شروع</label>
            <select id="startTime"></select>
        </div>

        <div class="input-group">
            <label>ساعت پایان</label>
            <select id="endTime"></select>
        </div>

        <div class="input-group">
            <label>&nbsp;</label>
            <button class="btn-add" onclick="addTask()">+ افزودن به برنامه</button>
        </div>

        <div class="input-group" style="margin-right:auto">
             <label>&nbsp;</label>
             <div style="display:flex; gap:5px;">
                <button class="btn-clear" onclick="clearAllData()">پاکسازی همه</button>
                <button class="btn-print" onclick="window.print()">دانلود / پرینت PDF</button>
             </div>
        </div>
    </div>

    <!-- کانتینر اصلی برنامه -->
    <div id="planner" class="planner-container">
        <!-- روزها توسط جاوا اسکریپت اینجا ساخته می‌شوند -->
    </div>

    <script>
        const days = [
            { id: 'saturday', label: 'شنبه' },
            { id: 'sunday', label: 'یکشنبه' },
            { id: 'monday', label: 'دوشنبه' },
            { id: 'tuesday', label: 'سه‌شنبه' },
            { id: 'wednesday', label: 'چهارشنبه' },
            { id: 'thursday', label: 'پنج‌شنبه' },
            { id: 'friday', label: 'جمعه' }
        ];

        // تولید لیست زمان‌ها (هر ۱۵ دقیقه)
        const timeSlots = [];
        for (let h = 0; h < 24; h++) {
            for (let m = 0; m < 60; m += 15) {
                let hour = h.toString().padStart(2, '0');
                let minute = m.toString().padStart(2, '0');
                timeSlots.push(`${hour}:${minute}`);
            }
        }
        // اضافه کردن 24:00 برای پایان
        timeSlots.push("24:00");

        // آبجکت ذخیره اطلاعات
        let scheduleData = JSON.parse(localStorage.getItem('mySchedule')) || {};

        function init() {
            populateTimeSelects();
            renderPlanner();
        }

        // پر کردن دراپ‌داون‌های ساعت
        function populateTimeSelects() {
            const startSelect = document.getElementById('startTime');
            const endSelect = document.getElementById('endTime');
            
            // برای شروع تا 23:45
            timeSlots.slice(0, -1).forEach(time => {
                let opt = new Option(time, time);
                startSelect.add(opt);
            });

            // برای پایان از 00:15 تا 24:00
            timeSlots.slice(1).forEach(time => {
                let opt = new Option(time, time);
                endSelect.add(opt);
            });
            
            // پیش‌فرض
            startSelect.value = "08:00";
            endSelect.value = "09:00";
        }

        // رندر کردن ساختار HTML جدول
        function renderPlanner() {
            const container = document.getElementById('planner');
            container.innerHTML = '';

            days.forEach(day => {
                const dayCol = document.createElement('div');
                dayCol.className = 'day-column';
                
                // هدر روز
                const header = document.createElement('div');
                header.className = 'day-header';
                header.innerText = day.label;
                dayCol.appendChild(header);

                // کانتینر اسلات‌ها
                const slotsDiv = document.createElement('div');
                slotsDiv.className = 'slots-container';

                // ایجاد ۹۶ اسلات ۱۵ دقیقه‌ای
                // آخرین آیتم timeSlots (24:00) را برای شروع حلقه نیاز نداریم
                for (let i = 0; i < timeSlots.length - 1; i++) {
                    const time = timeSlots[i];
                    const row = document.createElement('div');
                    row.className = 'time-slot';
                    
                    // ستون ساعت
                    const timeLabel = document.createElement('div');
                    timeLabel.className = 'time-label';
                    timeLabel.innerText = time;
                    
                    // ستون تسک
                    const taskArea = document.createElement('div');
                    taskArea.className = 'task-area';
                    taskArea.id = `${day.id}-${time}`; // ID یکتا: saturday-10:15
                    
                    // چک کردن دیتای ذخیره شده
                    if (scheduleData[day.id] && scheduleData[day.id][time]) {
                        const taskInfo = scheduleData[day.id][time];
                        taskArea.classList.add('filled-task');
                        if (taskInfo.isStart) {
                            taskArea.classList.add('task-start');
                            taskArea.innerHTML = `<b>${taskInfo.name}</b>`;
                            taskArea.title = taskInfo.name; // تولتیپ
                        } else {
                            // برای اسلات‌های ادامه دار متن را تکرار نمی‌کنیم تا شلوغ نشود
                            // یا می‌توانیم کمرنگ نشان دهیم
                        }
                        
                        // قابلیت حذف با کلیک
                        taskArea.onclick = function() {
                            if(confirm('آیا می‌خواهید این برنامه را حذف کنید؟')) {
                                removeTask(day.id, taskInfo.groupId);
                            }
                        };
                    }

                    row.appendChild(timeLabel);
                    row.appendChild(taskArea);
                    slotsDiv.appendChild(row);
                }

                dayCol.appendChild(slotsDiv);
                container.appendChild(dayCol);
            });
        }

        // افزودن تسک جدید
        function addTask() {
            const name = document.getElementById('taskName').value;
            const day = document.getElementById('daySelect').value;
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;

            if (!name) { alert('لطفا نام فعالیت را بنویسید'); return; }
            if (start >= end) { alert('ساعت پایان باید بعد از ساعت شروع باشد'); return; }

            // پیدا کردن ایندکس‌ها
            const startIndex = timeSlots.indexOf(start);
            const endIndex = timeSlots.indexOf(end);

            // ایجاد شناسه گروهی برای حذف یکپارچه
            const groupId = Date.now();

            if (!scheduleData[day]) scheduleData[day] = {};

            // بررسی تداخل
            for (let i = startIndex; i < endIndex; i++) {
                const time = timeSlots[i];
                if (scheduleData[day][time]) {
                    if(!confirm(`در ساعت ${time} برنامه دیگری وجود دارد. جایگزین شود؟`)) {
                        return; 
                    }
                }
            }

            // ذخیره سازی
            for (let i = startIndex; i < endIndex; i++) {
                const time = timeSlots[i];
                scheduleData[day][time] = {
                    name: name,
                    isStart: (i === startIndex),
                    groupId: groupId
                };
            }

            saveData();
            renderPlanner();
        }

        // حذف تسک
        function removeTask(day, groupId) {
            const dayData = scheduleData[day];
            for (const time in dayData) {
                if (dayData[time].groupId === groupId) {
                    delete dayData[time];
                }
            }
            saveData();
            renderPlanner();
        }

        // ذخیره در لوکال استوریج
        function saveData() {
            localStorage.setItem('mySchedule', JSON.stringify(scheduleData));
        }

        function clearAllData() {
            if(confirm("آیا مطمئن هستید که کل برنامه پاک شود؟")) {
                localStorage.removeItem('mySchedule');
                scheduleData = {};
                renderPlanner();
            }
        }

        // اجرای اولیه
        init();

    </script>
</body>
</html>
