 <!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù¾Ù„Ù†Ø± Ø¬Ø§Ù…Ø¹ Ù†Ø³Ø®Ù‡ ØªØ¬Ø§Ø±ÛŒ (PRO)</title>
    <style>
        :root {
            --primary: #2563eb;       /* Ø¢Ø¨ÛŒ Ø§ØµÙ„ÛŒ */
            --primary-dark: #1e40af;
            --accent: #f59e0b;        /* Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª */
            --success: #10b981;       /* Ø³Ø¨Ø² */
            --danger: #ef4444;        /* Ù‚Ø±Ù…Ø² */
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #cbd5e1;
            --text: #334155;
            --select-bg: #bfdbfe;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 15px;
            color: var(--text);
            font-size: 13px;
            padding-bottom: 120px;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Ù†ÙˆØ§Ø± Ø§Ø¨Ø²Ø§Ø± --- */
        .toolbar {
            background: var(--surface);
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 4px 15px -3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toolbar-top {
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;
        }

        .app-brand {
            font-weight: 800; font-size: 16px; color: var(--primary-dark);
            display: flex; align-items: center; gap: 8px;
        }

        .toolbar-input {
            width: 100%; padding: 10px; border: 1px solid var(--border);
            border-radius: 8px; font-family: inherit; transition: 0.2s;
        }
        .toolbar-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        button {
            padding: 8px 14px; border: none; border-radius: 8px; cursor: pointer;
            font-family: inherit; font-weight: 600; font-size: 12px; color: white;
            display: flex; align-items: center; gap: 6px; transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button:active { transform: scale(0.98); }
        button svg { width: 16px; height: 16px; }

        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-dark { background: #475569; }
        .btn-accent { background: var(--accent); }
        .btn-purple { background: #8b5cf6; }

        /* Ø¯Ú©Ù…Ù‡ Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ */
        .mode-switch {
            background: #e2e8f0; color: #475569; border: 1px solid #cbd5e1; box-shadow: none;
        }
        .mode-switch.active {
            background: var(--primary); color: white; border-color: var(--primary-dark);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        /* --- Ø¬Ø¯ÙˆÙ„ --- */
        .table-container {
            background: var(--surface); border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            overflow: auto; position: relative; border: 1px solid var(--border);
            max-height: 75vh; overscroll-behavior: contain;
        }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; min-width: 850px; }
        
        thead { position: sticky; top: 0; z-index: 20; }
        th {
            background: #1e293b; color: white; padding: 10px;
            border: 1px solid #334155; user-select: none;
        }

        /* Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ø¯Ø± Ù‡Ø¯Ø± */
        .copy-btn {
            background: rgba(255,255,255,0.15); padding: 2px 6px; border-radius: 4px;
            font-size: 10px; margin-left: 5px; cursor: pointer; color: #fff;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.3); }

        th:first-child, td:first-child {
            width: 65px; background: #f1f5f9; color: #64748b; font-weight: bold;
            font-size: 10px; position: sticky; right: 0; z-index: 30;
            border-left: 2px solid #cbd5e1; text-align: center;
        }

        td {
            border: 1px solid #e2e8f0; text-align: center; height: 26px;
            padding: 0; vertical-align: middle; touch-action: auto;
        }

        /* Ø³Ù„ÙˆÙ„ ØªØ³Ú© */
        td.task-cell {
            color: white; padding: 2px; font-size: 11px; cursor: pointer;
            box-sizing: border-box; overflow: hidden; position: relative;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .task-content { pointer-events: none; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; }

        /* Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ */
        body.selection-mode td.empty-cell { touch-action: none; cursor: crosshair; }
        .selected-range { background-color: var(--select-bg) !important; }

        /* --- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÙØ²ÙˆØ¯Ù†ÛŒâ€ŒÙ‡Ø§ (Ù…Ù†Ùˆ) --- */
        .extras-list {
            list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto;
            border: 1px solid #eee; border-radius: 8px; margin-top: 10px;
        }
        .extra-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 10px; border-bottom: 1px solid #f1f5f9; background: #fff;
        }
        .extra-item:last-child { border-bottom: none; }
        .extra-controls { display: flex; align-items: center; gap: 8px; }
        
        /* Ø³ÙˆÛŒÛŒÚ† Ù†Ù…Ø§ÛŒØ´/Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ */
        .toggle-eye { cursor: pointer; opacity: 0.4; transition: 0.2s; }
        .toggle-eye.visible { opacity: 1; color: var(--primary); }
        .toggle-eye:hover { transform: scale(1.1); }

        /* --- Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            justify-content: center; align-items: center; backdrop-filter: blur(4px);
        }
        .modal {
            background: white; padding: 20px; border-radius: 16px; width: 90%; max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display: flex; flex-direction: column; gap: 15px;
            max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .modal-header h3 { margin: 0; font-size: 16px; color: #1e293b; }

        /* --- Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÛŒÙ†Øª (Ù…Ø®ÙÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ) --- */
        #print-header-section, #print-extras-section, #print-footer-note { display: none; }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ú†Ø§Ù¾ --- */
        @media print {
            @page { size: A4 landscape; margin: 5mm; }
            body { background: white; padding: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .no-print, .toolbar, .copy-btn { display: none !important; }
            
            /* Ø³Ø§Ø®ØªØ§Ø± ØµÙØ­Ù‡ Ú†Ø§Ù¾ */
            #print-header-section {
                display: block; text-align: center; margin-bottom: 10px;
                border-bottom: 2px solid #000; padding-bottom: 5px;
            }
            #print-title-text { font-size: 22px; font-weight: 900; color: #000; }

            /* Ø¨Ø®Ø´ Ø§Ù„Ø²Ø§Ù…Ø§Øª Ùˆ Ú†Ú© Ù„ÛŒØ³Øª Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ */
            #print-extras-section {
                display: flex; gap: 20px; margin-bottom: 10px; font-size: 11px;
                justify-content: space-between; align-items: flex-start;
                border: 1px solid #ccc; padding: 10px; border-radius: 5px;
            }
            .print-col { flex: 1; }
            .print-col h4 { margin: 0 0 5px 0; border-bottom: 1px solid #000; padding-bottom: 2px; font-size: 12px; }
            .print-list { list-style: none; padding: 0; margin: 0; }
            .print-list li { margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }

            /* Ø¬Ø¯ÙˆÙ„ */
            .table-container { box-shadow: none; border: none; overflow: visible; max-height: none; }
            table { border: 2px solid #000; width: 100%; font-size: 10px; }
            thead { display: table-header-group; }
            tr { page-break-inside: avoid; }
            th { background-color: #e2e8f0 !important; color: #000 !important; border: 1px solid #000; }
            td { border: 1px solid #666; height: 18px; } /* ÙØ´Ø±Ø¯Ù‡ */
            td.task-cell { border: 1px solid #000 !important; color: #000 !important; font-weight: bold; }

            /* ÙÙˆØªØ± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª */
            #print-footer-note {
                display: block; margin-top: 15px; padding: 10px; border: 1px dashed #666;
                border-radius: 5px; font-size: 11px; background: #fafafa;
                page-break-inside: avoid;
            }
            #print-footer-note h4 { margin: 0 0 5px 0; }
            .landscape-warning { display: none; } /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø± Ø®ÙˆØ¯ Ú†Ø§Ù¾ */
        }
    </style>
</head>
<body>

    <!-- Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØµÙˆØµ Ù¾Ø±ÛŒÙ†Øª -->
    <div id="print-header-section">
        <div id="print-title-text">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ</div>
    </div>

    <div id="print-extras-section">
        <!-- Ø³ØªÙˆÙ† Ø³Ù…Øª Ø±Ø§Ø³Øª: Ù†Ú©Ø§Øª/Ø§Ù„Ø²Ø§Ù…Ø§Øª -->
        <div class="print-col">
            <h4>ğŸ”¸ Ù†Ú©Ø§Øª Ùˆ Ø§Ù„Ø²Ø§Ù…Ø§Øª</h4>
            <ul class="print-list" id="print-req-list"></ul>
        </div>
        <!-- Ø³ØªÙˆÙ† Ø³Ù…Øª Ú†Ù¾: Ú†Ú© Ù„ÛŒØ³Øª -->
        <div class="print-col" style="border-right: 1px solid #ccc; padding-right: 20px;">
            <h4>â–«ï¸ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù…ÙˆØ§Ø±Ø¯</h4>
            <ul class="print-list" id="print-check-list"></ul>
        </div>
    </div>

    <!-- Ù†ÙˆØ§Ø± Ø§Ø¨Ø²Ø§Ø± -->
    <div class="toolbar no-print">
        <div class="toolbar-top">
            <div class="app-brand">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                Ù¾Ù„Ù†Ø± Ø¬Ø§Ù…Ø¹ PRO
            </div>

            <button class="mode-switch" id="selectionModeBtn" onclick="toggleSelectionMode()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path></svg>
                <span id="modeText">Ø­Ø§Ù„Øª Ø§Ø³Ú©Ø±ÙˆÙ„</span> (Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨)
            </button>
        </div>

        <input type="text" class="toolbar-input" id="headerInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø³Ø±Ø¨Ø±Ú¯ Ù¾Ø±ÛŒÙ†Øª (Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÙ‡ Ø§ÙˆÙ„ Ù…Ù‡Ø± Ù…Ø§Ù‡)" oninput="updateHeader(this.value)">

        <div class="toolbar-top">
            <button class="btn-purple" onclick="openExtrasModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                Ø§Ù„Ø²Ø§Ù…Ø§Øª Ùˆ Ú†Ú©â€ŒÙ„ÛŒØ³Øª
            </button>

            <button class="btn-accent" onclick="openNotepad()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
            </button>
            
            <div style="flex:1"></div>

            <button class="btn-success" onclick="exportData()">ğŸ’¾ Ø¨Ú©â€ŒØ¢Ù¾</button>
            <button class="btn-primary" onclick="document.getElementById('fileInput').click()">ğŸ“‚ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ</button>
            <input type="file" id="fileInput" hidden onchange="importData(this)">
            
            <button class="btn-dark" onclick="printApp()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                Ù¾Ø±ÛŒÙ†Øª
            </button>
            <button class="btn-danger" onclick="clearAll()">ğŸ—‘ Ø­Ø°Ù Ú©Ù„</button>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ -->
    <div class="table-container">
        <table id="plannerTable">
            <thead>
                <tr id="headerRow"><th>Ø³Ø§Ø¹Øª</th></tr>
            </thead>
            <tbody id="plannerBody"></tbody>
        </table>
    </div>

    <!-- ÙÙˆØªØ± ÛŒØ§Ø¯Ø¯Ø§Ø´Øª (Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´ÙˆØ¯) -->
    <div id="print-footer-note">
        <h4>ğŸ“ ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§:</h4>
        <div id="print-note-content" style="white-space: pre-wrap;"></div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù†ÛŒâ€ŒÙ‡Ø§ (Ú†Ú© Ù„ÛŒØ³Øª Ùˆ Ø§Ù„Ø²Ø§Ù…Ø§Øª) -->
    <div class="modal-overlay" id="extrasModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆØ§Ø±Ø¯ Ø§Ø¶Ø§ÙÛŒ</h3>
                <button class="btn-danger" onclick="closeModal('extrasModal')" style="padding:4px 8px;">âœ•</button>
            </div>
            
            <!-- ØªØ¨ Ø¨Ù†Ø¯ÛŒ Ø³Ø§Ø¯Ù‡ -->
            <div style="display:flex; gap:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                <button class="btn-primary" style="flex:1" onclick="showTab('tab-req')">ğŸ”¸ Ù†Ú©Ø§Øª</button>
                <button class="btn-dark" style="flex:1" onclick="showTab('tab-chk')">â–«ï¸ Ú†Ú©â€ŒÙ„ÛŒØ³Øª</button>
            </div>

            <!-- ØªØ¨ Ù†Ú©Ø§Øª -->
            <div id="tab-req" style="display:block;">
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <input type="text" id="reqInput" class="toolbar-input" placeholder="Ù†Ú©ØªÙ‡ Ø¬Ø¯ÛŒØ¯...">
                    <button class="btn-success" onclick="addRequirement()">+</button>
                </div>
                <div style="font-size:10px; color:#666; margin-top:5px;">Ú†Ø´Ù…: Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª</div>
                <ul class="extras-list" id="reqListUi"></ul>
            </div>

            <!-- ØªØ¨ Ú†Ú© Ù„ÛŒØ³Øª -->
            <div id="tab-chk" style="display:none;">
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <input type="text" id="chkInput" class="toolbar-input" placeholder="Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯...">
                    <button class="btn-success" onclick="addChecklist()">+</button>
                </div>
                <div style="font-size:10px; color:#666; margin-top:5px;">Ú†Ø´Ù…: Ù†Ù…Ø§ÛŒØ´ | ØªÛŒÚ©: ÙˆØ¶Ø¹ÛŒØª Ø§Ù†Ø¬Ø§Ù…</div>
                <ul class="extras-list" id="chkListUi"></ul>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ ÙØ¹Ø§Ù„ÛŒØª -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <h3>Ù…Ø¯ÛŒØ±ÛŒØª ÙØ¹Ø§Ù„ÛŒØª</h3>
            <input type="hidden" id="taskId">
            <input type="hidden" id="taskDay">
            <input type="hidden" id="taskStartStr">
            
            <div style="font-size:12px; color:#666;" id="timeInfo"></div>
            
            <div>
                <label style="font-size:11px; font-weight:bold;">Ø¹Ù†ÙˆØ§Ù†:</label>
                <input type="text" id="inpName" class="toolbar-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙˆØ±Ø²Ø´" autofocus>
            </div>

            <div>
                <label style="font-size:11px; font-weight:bold;">Ù…Ø¯Øª Ø²Ù…Ø§Ù†:</label>
                <select id="inpDuration" class="toolbar-input"></select>
            </div>

            <div>
                <label style="font-size:11px; font-weight:bold;">Ø±Ù†Ú¯:</label>
                <div style="display:flex; gap:5px; flex-wrap:wrap; margin-top:5px;">
                    <div onclick="setColor('#3b82f6')" style="width:25px;height:25px;background:#3b82f6;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 1px #ccc"></div>
                    <div onclick="setColor('#10b981')" style="width:25px;height:25px;background:#10b981;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 1px #ccc"></div>
                    <div onclick="setColor('#ef4444')" style="width:25px;height:25px;background:#ef4444;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 1px #ccc"></div>
                    <div onclick="setColor('#f59e0b')" style="width:25px;height:25px;background:#f59e0b;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 1px #ccc"></div>
                    <div onclick="setColor('#8b5cf6')" style="width:25px;height:25px;background:#8b5cf6;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 0 1px #ccc"></div>
                    <input type="color" id="inpColor" value="#3b82f6" style="margin-right:auto">
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <button class="btn-danger" id="btnDelete" onclick="deleteTask()" style="display:none">Ø­Ø°Ù</button>
                <div style="flex:1"></div>
                <button class="btn-dark" onclick="closeModal('taskModal')" style="margin-left:5px;">Ù„ØºÙˆ</button>
                <button class="btn-primary" onclick="saveTask()">Ø°Ø®ÛŒØ±Ù‡</button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª -->
    <div class="modal-overlay" id="noteModal">
        <div class="modal">
            <h3>Ø¯ÙØªØ±Ú†Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</h3>
            <textarea id="noteArea" class="toolbar-input" rows="10" placeholder="ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§..."></textarea>
            <div style="display:flex; align-items:center; gap:5px;">
                <input type="checkbox" id="showNoteInPrint">
                <label for="showNoteInPrint" style="font-size:12px;">Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ù¾Ø±ÛŒÙ†Øª</label>
            </div>
            <div style="display:flex; justify-content:flex-end; margin-top:10px;">
                <button class="btn-primary" onclick="saveNote()">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø³ØªÙ†</button>
            </div>
        </div>
    </div>

    <script>
        const DAYS = [
            {id:'sat', l:'Ø´Ù†Ø¨Ù‡'}, {id:'sun', l:'ÛŒÚ©Ø´Ù†Ø¨Ù‡'}, {id:'mon', l:'Ø¯ÙˆØ´Ù†Ø¨Ù‡'},
            {id:'tue', l:'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡'}, {id:'wed', l:'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡'}, {id:'thu', l:'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡'}, {id:'fri', l:'Ø¬Ù…Ø¹Ù‡'}
        ];
        const TIMELINE = [];
        for(let h=0;h<24;h++) for(let m=0;m<60;m+=15) TIMELINE.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`);

        // Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡ Ø¬Ø§Ù…Ø¹
        let appData = {
            tasks: [],
            headerTitle: "",
            notes: { text: "", showInPrint: false },
            requirements: [
                { id: 1, text: "Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù‚Ø³Ø§Ø· ÙˆØ§Ù…", show: true },
                { id: 2, text: "Ù¾Ø±Ø¯Ø§Ø®Øª Ù‚Ø¨Ø¶ Ø¨Ø±Ù‚", show: true }
            ],
            checklists: [
                { id: 1, text: "Ø®Ø±ÛŒØ¯ Ù‡ÙØªÚ¯ÛŒ", show: true, checked: false },
                { id: 2, text: "Ø³Ø±ÙˆÛŒØ³ Ù…Ø§Ø´ÛŒÙ†", show: true, checked: false }
            ]
        };

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨
        let isSelectMode = false, isDrag = false;
        let selStart = null, selCurr = null;

        function init() {
            const saved = localStorage.getItem('proPlannerBiz');
            if(saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Ø§Ø¯ØºØ§Ù… Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´ÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ
                    if(!Array.isArray(parsed)) appData = { ...appData, ...parsed };
                    else appData.tasks = parsed; // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ù†Ø³Ø®Ù‡ Ù‚Ø¯ÛŒÙ…ÛŒ
                } catch(e){}
            }

            // Ù¾Ø± Ú©Ø±Ø¯Ù† UI Ø§ÙˆÙ„ÛŒÙ‡
            document.getElementById('headerInput').value = appData.headerTitle || "";
            document.getElementById('print-title-text').innerText = appData.headerTitle || "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ";
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø³Ù„Ú©ØªÙˆØ± Ø²Ù…Ø§Ù†
            const durSel = document.getElementById('inpDuration');
            for(let i=1;i<=24;i++) durSel.add(new Option(`${i*15} Ø¯Ù‚ÛŒÙ‚Ù‡ (${i/4} Ø³Ø§Ø¹Øª)`, i));

            renderHeader();
            renderTable();
            setupTouch();
        }

        // --- Ø±Ù†Ø¯Ø±ÛŒÙ†Ú¯ ---
        function renderHeader() {
            const row = document.getElementById('headerRow');
            while(row.children.length > 1) row.removeChild(row.lastChild);
            DAYS.forEach(d => {
                const th = document.createElement('th');
                th.innerHTML = `<div>${d.l} <span class="copy-btn" onclick="copyDay('${d.id}')">ğŸ“‹</span></div>`;
                row.appendChild(th);
            });
        }

        function renderTable() {
            const tbody = document.getElementById('plannerBody');
            tbody.innerHTML = '';
            const occupied = {}; DAYS.forEach(d=>occupied[d.id]=new Array(TIMELINE.length).fill(false));

            TIMELINE.forEach((time, idx) => {
                const tr = document.createElement('tr');
                const tdTime = document.createElement('td'); tdTime.innerText = time; tr.appendChild(tdTime);

                DAYS.forEach(day => {
                    if(occupied[day.id][idx]) return;
                    const task = appData.tasks.find(t => t.day===day.id && t.startStr===time);

                    if(task) {
                        const td = document.createElement('td');
                        td.rowSpan = task.duration;
                        td.className = 'task-cell';
                        td.style.backgroundColor = task.color;
                        td.innerHTML = `<div class="task-content"><b>${task.name}</b></div>`;
                        td.onclick = (e) => { e.stopPropagation(); openTaskModal(task); };
                        tr.appendChild(td);
                        for(let i=1; i<task.duration; i++) if(idx+i < TIMELINE.length) occupied[day.id][idx+i]=true;
                    } else {
                        const td = document.createElement('td');
                        td.className = 'empty-cell';
                        td.dataset.d = day.id; td.dataset.i = idx;
                        tr.appendChild(td);
                    }
                });
                tbody.appendChild(tr);
            });
        }

        // --- Ø³ÛŒØ³ØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ (Touch/Drag) ---
        function toggleSelectionMode() {
            isSelectMode = !isSelectMode;
            const btn = document.getElementById('selectionModeBtn');
            const txt = document.getElementById('modeText');
            if(isSelectMode) {
                document.body.classList.add('selection-mode');
                btn.classList.add('active'); txt.innerText = "Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ ÙØ¹Ø§Ù„";
            } else {
                document.body.classList.remove('selection-mode');
                btn.classList.remove('active'); txt.innerText = "Ø­Ø§Ù„Øª Ø§Ø³Ú©Ø±ÙˆÙ„";
                clearSel();
            }
        }

        function setupTouch() {
            const table = document.getElementById('plannerTable');
            
            const startHandler = (e) => {
                if(!isSelectMode) return;
                const cell = e.target.closest('td.empty-cell');
                if(!cell) return;
                e.preventDefault();
                isDrag = true;
                selStart = { d: cell.dataset.d, i: parseInt(cell.dataset.i) };
                selCurr = { ...selStart };
                highlight();
            };

            const moveHandler = (e) => {
                if(!isDrag) return;
                const el = document.elementFromPoint(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);
                if(!el) return;
                const cell = el.closest('td.empty-cell');
                if(cell && cell.dataset.d === selStart.d) {
                    selCurr = { d: selStart.d, i: parseInt(cell.dataset.i) };
                    highlight();
                }
            };

            const endHandler = () => {
                if(!isDrag) return;
                isDrag = false;
                if(selStart && selCurr) {
                    const s = Math.min(selStart.i, selCurr.i);
                    const dur = Math.max(selStart.i, selCurr.i) - s + 1;
                    openTaskModal(null, { d: selStart.d, s: TIMELINE[s], dur });
                }
                clearSel();
            };

            table.addEventListener('mousedown', startHandler);
            table.addEventListener('touchstart', startHandler, {passive: false});
            window.addEventListener('mousemove', moveHandler);
            window.addEventListener('touchmove', moveHandler, {passive: false});
            window.addEventListener('mouseup', endHandler);
            window.addEventListener('touchend', endHandler);
        }

        function highlight() {
            document.querySelectorAll('.selected-range').forEach(e=>e.classList.remove('selected-range'));
            if(!selStart || !selCurr) return;
            const s = Math.min(selStart.i, selCurr.i), e = Math.max(selStart.i, selCurr.i);
            for(let i=s; i<=e; i++) {
                const td = document.querySelector(`td.empty-cell[data-d="${selStart.d}"][data-i="${i}"]`);
                if(td) td.classList.add('selected-range');
            }
        }
        function clearSel() { 
            selStart = null; selCurr = null; 
            document.querySelectorAll('.selected-range').forEach(e=>e.classList.remove('selected-range'));
        }

        // --- Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Ú© ---
        function openTaskModal(task, newInf) {
            const modal = document.getElementById('taskModal');
            const btnDel = document.getElementById('btnDelete');
            
            if(task) {
                document.getElementById('taskId').value = task.id;
                document.getElementById('taskDay').value = task.day;
                document.getElementById('taskStartStr').value = task.startStr;
                document.getElementById('inpName').value = task.name;
                document.getElementById('inpDuration').value = task.duration;
                document.getElementById('inpColor').value = task.color;
                document.getElementById('timeInfo').innerText = `ÙˆÛŒØ±Ø§ÛŒØ´: ${task.startStr}`;
                btnDel.style.display = 'block';
            } else {
                document.getElementById('taskId').value = '';
                document.getElementById('taskDay').value = newInf.d;
                document.getElementById('taskStartStr').value = newInf.s;
                document.getElementById('inpName').value = '';
                document.getElementById('inpDuration').value = newInf.dur;
                document.getElementById('inpColor').value = '#3b82f6';
                document.getElementById('timeInfo').innerText = `Ø¬Ø¯ÛŒØ¯: ${newInf.s}`;
                btnDel.style.display = 'none';
            }
            modal.style.display = 'flex';
            document.getElementById('inpName').focus();
        }

        function saveTask() {
            const id = document.getElementById('taskId').value;
            const day = document.getElementById('taskDay').value;
            const startStr = document.getElementById('taskStartStr').value;
            const name = document.getElementById('inpName').value.trim();
            const duration = parseInt(document.getElementById('inpDuration').value);
            const color = document.getElementById('inpColor').value;

            if(!name) return alert("Ù†Ø§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª");
            const sIdx = TIMELINE.indexOf(startStr);
            if(sIdx + duration > TIMELINE.length) return alert("Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¨Ø§Ø²Ù‡ Ø±ÙˆØ²");

            const conflict = appData.tasks.some(t => {
                if(t.id == id || t.day !== day) return false;
                const tS = TIMELINE.indexOf(t.startStr);
                return (sIdx < tS+t.duration && sIdx+duration > tS);
            });
            if(conflict) return alert("ØªØ¯Ø§Ø®Ù„ Ø²Ù…Ø§Ù†ÛŒ!");

            if(id) {
                const idx = appData.tasks.findIndex(t => t.id == id);
                if(idx!==-1) appData.tasks[idx] = {...appData.tasks[idx], name, duration, color};
            } else {
                appData.tasks.push({id:Date.now(), day, startStr, duration, name, color});
            }
            saveAndRender();
            closeModal('taskModal');
        }

        function deleteTask() {
            const id = document.getElementById('taskId').value;
            if(confirm("Ø­Ø°Ù Ø´ÙˆØ¯ØŸ")) {
                appData.tasks = appData.tasks.filter(t=>t.id!=id);
                saveAndRender();
                closeModal('taskModal');
            }
        }

        // --- Ù…Ø¯ÛŒØ±ÛŒØª Ø§ÙØ²ÙˆØ¯Ù†ÛŒâ€ŒÙ‡Ø§ (Ù†Ú©Ø§Øª Ùˆ Ú†Ú© Ù„ÛŒØ³Øª) ---
        function openExtrasModal() {
            document.getElementById('extrasModal').style.display = 'flex';
            renderExtrasList();
        }
        
        function showTab(id) {
            document.getElementById('tab-req').style.display = (id==='tab-req')?'block':'none';
            document.getElementById('tab-chk').style.display = (id==='tab-chk')?'block':'none';
        }

        function renderExtrasList() {
            // Ø±Ù†Ø¯Ø± Ù†Ú©Ø§Øª
            const reqList = document.getElementById('reqListUi');
            reqList.innerHTML = '';
            appData.requirements.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'extra-item';
                li.innerHTML = `
                    <span>ğŸ”¸ ${item.text}</span>
                    <div class="extra-controls">
                        <span class="toggle-eye ${item.show?'visible':''}" onclick="toggleExtra('req', ${index})">ğŸ‘</span>
                        <span style="cursor:pointer;color:red;font-size:16px;" onclick="deleteExtra('req', ${index})">âœ•</span>
                    </div>
                `;
                reqList.appendChild(li);
            });

            // Ø±Ù†Ø¯Ø± Ú†Ú© Ù„ÛŒØ³Øª
            const chkList = document.getElementById('chkListUi');
            chkList.innerHTML = '';
            appData.checklists.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'extra-item';
                li.innerHTML = `
                    <span>â–«ï¸ ${item.text}</span>
                    <div class="extra-controls">
                        <input type="checkbox" ${item.checked?'checked':''} onchange="toggleCheck(${index})">
                        <span class="toggle-eye ${item.show?'visible':''}" onclick="toggleExtra('chk', ${index})">ğŸ‘</span>
                        <span style="cursor:pointer;color:red;font-size:16px;" onclick="deleteExtra('chk', ${index})">âœ•</span>
                    </div>
                `;
                chkList.appendChild(li);
            });
        }

        function addRequirement() {
            const txt = document.getElementById('reqInput').value.trim();
            if(txt) { appData.requirements.push({text: txt, show: true}); document.getElementById('reqInput').value=''; saveAndRender(); renderExtrasList(); }
        }
        function addChecklist() {
            const txt = document.getElementById('chkInput').value.trim();
            if(txt) { appData.checklists.push({text: txt, show: true, checked: false}); document.getElementById('chkInput').value=''; saveAndRender(); renderExtrasList(); }
        }
        function toggleExtra(type, index) {
            if(type==='req') appData.requirements[index].show = !appData.requirements[index].show;
            else appData.checklists[index].show = !appData.checklists[index].show;
            saveAndRender(); renderExtrasList();
        }
        function deleteExtra(type, index) {
            if(type==='req') appData.requirements.splice(index, 1);
            else appData.checklists.splice(index, 1);
            saveAndRender(); renderExtrasList();
        }
        function toggleCheck(index) {
            appData.checklists[index].checked = !appData.checklists[index].checked;
            saveAndRender();
        }

        // --- ÛŒØ§Ø¯Ø¯Ø§Ø´Øª ---
        function openNotepad() {
            document.getElementById('noteModal').style.display = 'flex';
            document.getElementById('noteArea').value = appData.notes.text || "";
            document.getElementById('showNoteInPrint').checked = appData.notes.showInPrint || false;
        }
        function saveNote() {
            appData.notes.text = document.getElementById('noteArea').value;
            appData.notes.showInPrint = document.getElementById('showNoteInPrint').checked;
            saveAndRender();
            closeModal('noteModal');
        }

        // --- Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ù¾Ø±ÛŒÙ†Øª ---
        function updateHeader(val) { appData.headerTitle = val; document.getElementById('print-title-text').innerText = val; saveData(); }
        function setColor(c) { document.getElementById('inpColor').value = c; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function saveAndRender() { localStorage.setItem('proPlannerBiz', JSON.stringify(appData)); renderTable(); }
        function clearAll() { if(confirm("Ø­Ø°Ù Ú©Ø§Ù…Ù„ØŸ")) { localStorage.removeItem('proPlannerBiz'); location.reload(); } }

        function copyDay(srcId) {
            const target = prompt("Ù†Ø§Ù… Ø±ÙˆØ² Ù…Ù‚ØµØ¯ (Ù…Ø«Ù„Ø§Ù‹: Ø¯ÙˆØ´Ù†Ø¨Ù‡):");
            const tDay = DAYS.find(d=>d.l===target?.trim());
            if(!tDay) return;
            if(confirm(`Ú©Ù¾ÛŒ ${DAYS.find(d=>d.id===srcId).l} Ø¨Ù‡ ${tDay.l}ØŸ`)) {
                appData.tasks = appData.tasks.filter(t=>t.day!==tDay.id);
                appData.tasks.filter(t=>t.day===srcId).forEach(t => {
                    appData.tasks.push({...t, id:Date.now()+Math.random(), day:tDay.id});
                });
                saveAndRender();
            }
        }

        // Ø¢Ù…Ø§Ø¯Ù‡ Ø³Ø§Ø²ÛŒ Ù¾Ø±ÛŒÙ†Øª
        function printApp() {
            // 1. Ù¾Ø± Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù†Ú©Ø§Øª Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª
            const pReq = document.getElementById('print-req-list');
            pReq.innerHTML = '';
            appData.requirements.filter(i=>i.show).forEach(i => {
                pReq.innerHTML += `<li>ğŸ”¸ ${i.text}</li>`;
            });

            // 2. Ù¾Ø± Ú©Ø±Ø¯Ù† Ú†Ú© Ù„ÛŒØ³Øª Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª
            const pChk = document.getElementById('print-check-list');
            pChk.innerHTML = '';
            appData.checklists.filter(i=>i.show).forEach(i => {
                const mark = i.checked ? 'â˜‘' : 'â¬œ';
                pChk.innerHTML += `<li>${mark} ${i.text}</li>`;
            });

            // 3. Ù†Ù…Ø§ÛŒØ´ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª
            const noteDiv = document.getElementById('print-footer-note');
            const noteContent = document.getElementById('print-note-content');
            if(appData.notes.showInPrint && appData.notes.text) {
                noteDiv.style.display = 'block';
                noteContent.innerText = appData.notes.text;
            } else {
                noteDiv.style.display = 'none';
            }

            // Ù‡Ø´Ø¯Ø§Ø±
            alert("Ù†Ú©ØªÙ‡: Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ ØµØ­ÛŒØ­ØŒ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÛŒÙ†Øª Ú¯Ø²ÛŒÙ†Ù‡ Layout Ø±Ø§ Ø±ÙˆÛŒ 'Landscape' (Ø§ÙÙ‚ÛŒ) Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.");
            window.print();
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(appData)], {type:"application/json"});
            const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="plan_backup.json"; a.click();
        }
        function importData(inp) {
            const f=inp.files[0]; if(!f)return;
            const r=new FileReader(); r.onload=e=>{
                try {
                    const d=JSON.parse(e.target.result);
                    if(d.tasks || Array.isArray(d)) {
                         if(Array.isArray(d)) appData.tasks = d; else appData = d;
                         saveAndRender(); location.reload();
                    }
                }catch(x){alert("ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±");}
            }; r.readAsText(f);
        }

        init();
    </script>
</body>
</html>
