<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø¨ÙˆØ¯Ø¬Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ | Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary: #3b82f6;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --text-dark: #1e293b;
            --border-radius: 16px;
        }

        * {
            box-sizing: border-box;
            font-family: 'Vazirmatn', sans-serif;
            outline: none;
        }

        body {
            background: var(--bg-gradient);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            color: var(--text-dark);
        }

        .dashboard {
            background: var(--card-bg);
            width: 100%;
            max-width: 900px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Ù‡Ø¯Ø± Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        .header {
            background: #fff;
            padding: 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .title-box h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-box select {
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            font-size: 0.9rem;
            background: #f8fafc;
            cursor: pointer;
        }

        /* ÙˆØ±ÙˆØ¯ÛŒ Ø§ØµÙ„ÛŒ Ù¾ÙˆÙ„ */
        .input-hero {
            background: #eff6ff;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .input-group {
            position: relative;
            max-width: 400px;
            margin: 0 auto;
        }

        .input-group i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
            font-size: 1.2rem;
        }

        .main-input {
            width: 100%;
            padding: 15px 50px 15px 15px;
            font-size: 1.5rem;
            border: 2px solid #bfdbfe;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            transition: 0.3s;
            direction: ltr;
        }

        .main-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±ØµØ¯ */
        .progress-container {
            margin-top: 15px;
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease, background 0.3s;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        /* Ù„ÛŒØ³Øª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ */
        .items-list {
            padding: 20px;
            background: #f8fafc;
            flex-grow: 1;
        }

        .budget-item {
            display: grid;
            grid-template-columns: 3fr 1.5fr 3fr 40px;
            gap: 15px;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .budget-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-color: var(--primary);
        }

        .item-name {
            font-weight: bold;
            border: none;
            background: transparent;
            font-size: 1rem;
            width: 100%;
        }

        .percent-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .percent-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            direction: ltr;
        }

        .percent-symbol {
            position: absolute;
            left: 10px;
            color: #94a3b8;
            font-size: 0.8rem;
        }

        .amount-display {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 800;
            color: var(--text-dark);
            font-size: 1.1rem;
            border-right: 4px solid var(--primary);
        }

        .btn-remove {
            color: #94a3b8;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-remove:hover { color: var(--danger); }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ Ø§Ú©Ø´Ù†â€ŒÙ‡Ø§ */
        .actions {
            padding: 20px;
            background: #fff;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            justify-content: space-between;
            position: sticky;
            bottom: 0;
            z-index: 10;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.2s;
            font-size: 1rem;
        }

        .btn-calc {
            background: var(--primary);
            color: white;
            flex-grow: 2;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        .btn-calc:hover { background: #1d4ed8; transform: translateY(-1px); }
        .btn-calc:active { transform: translateY(1px); }

        .btn-add {
            background: #eff6ff;
            color: var(--primary);
            border: 1px solid #bfdbfe;
        }
        .btn-add:hover { background: #dbeafe; }

        /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 650px) {
            .budget-item {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            .item-name { grid-column: 1 / -1; font-size: 1.1rem; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 5px;}
            .btn-remove { grid-column: 2 / 3; justify-self: end; grid-row: 1; }
            .percent-input-group { grid-column: 1 / 2; }
            .amount-display { grid-column: 2 / 3; }
            .header { justify-content: center; }
            .actions { flex-direction: column-reverse; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div class="dashboard">
    <!-- Ù‡Ø¯Ø± -->
    <div class="header">
        <div class="title-box">
            <h1><i class="fas fa-wallet"></i> Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø¨ÙˆØ¯Ø¬Ù‡</h1>
        </div>
        <div class="settings-box">
            <select id="currencySelector" onchange="reCalculate()">
                <option value="ØªÙˆÙ…Ø§Ù†">Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØªÙˆÙ…Ø§Ù†</option>
                <option value="Ø±ÛŒØ§Ù„">Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ Ø±ÛŒØ§Ù„</option>
            </select>
        </div>
    </div>

    <!-- ÙˆØ±ÙˆØ¯ÛŒ Ù¾ÙˆÙ„ -->
    <div class="input-hero">
        <label style="display:block; margin-bottom:10px; color:#64748b;">Ù…Ø¨Ù„Øº ÙˆØ±ÙˆØ¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</label>
        <div class="input-group">
            <i class="fas fa-coins"></i>
            <input type="text" id="totalAmount" class="main-input" placeholder="0" onkeyup="handleMainInput(this)">
        </div>
        
        <!-- Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±ØµØ¯ -->
        <div style="max-width: 400px; margin: 20px auto 0;">
            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div class="progress-info">
                <span id="percentText">Ø¬Ù…Ø¹ Ø¯Ø±ØµØ¯: Û°Ùª</span>
                <span id="statusMessage" style="color: var(--success)">Ù‡Ù…Ù‡ Ú†ÛŒ Ù…Ø±ØªØ¨Ù‡</span>
            </div>
        </div>
    </div>

    <!-- Ù„ÛŒØ³Øª Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ -->
    <div id="itemsList" class="items-list">
        <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ ØªÙˆØ³Ø· Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
    </div>

    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
    <div class="actions">
        <button class="btn btn-add" onclick="addRow()"><i class="fas fa-plus"></i> Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯</button>
        <button class="btn btn-calc" onclick="calculateAll()"><i class="fas fa-calculator"></i> Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†</button>
    </div>
</div>

<script>
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ†
    const defaultBudgets = [
        { name: "Û±. Ú©Ø±Ø§ÛŒÙ‡ Ø´Ù‡Ø±ÛŒ", percent: 27 },
        { name: "Û². Ø®ÙˆØ±Ø¯ Ùˆ Ø®ÙˆØ±Ø§Ú©", percent: 12 },
        { name: "Û³. Ø³ÙØ± (Ù…Ø´Ù‡Ø¯)", percent: 25 },
        { name: "Û´. Ø¯ÙˆØ§ Ùˆ Ø¯Ø±Ù…Ø§Ù†", percent: 3 },
        { name: "Ûµ. Ø´Ø§Ø±Ú˜ Ùˆ Ø§ÛŒÙ†ØªØ±Ù†Øª", percent: 10 },
        { name: "Û¶. Ø²ÛŒØ¨Ø§ÛŒÛŒ Ùˆ Ù…Ú©Ù…Ù„", percent: 7 },
        { name: "Û·. Ù„Ø¨Ø§Ø³", percent: 5 },
        { name: "Û¸. Ø¶Ø±ÙˆØ±ÛŒ Ùˆ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ", percent: 5 },
        { name: "Û¹. Ù‡Ø¯ÛŒÙ‡ Ùˆ ØªÙØ±ÛŒØ­", percent: 3 },
        { name: "Û±Û°. Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø² Ú©Ù„", percent: 3 }
    ];

    const itemsContainer = document.getElementById('itemsList');
    const currencySelector = document.getElementById('currencySelector');
    let currentCurrency = "ØªÙˆÙ…Ø§Ù†";

    // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ (Ù‚Ù„Ø¨ ØªÙ¾Ù†Ø¯Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡)
    function toEnglishDigits(str) {
        if(!str) return "";
        return str.toString().replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d));
    }

    // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
    function toPersianDigits(num) {
        if(num === null || num === undefined) return "";
        return num.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
    }

    // ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ù¾ÙˆÙ„ (Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù…)
    function formatMoney(amount) {
        if (isNaN(amount)) return "0";
        // Ø­Ø°Ù Ø§Ø¹Ø´Ø§Ø± Ø§Ø¶Ø§ÙÛŒ
        amount = Math.round(amount);
        return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
    function init() {
        defaultBudgets.forEach(item => {
            createRowHTML(item.name, item.percent);
        });
        updatePercentBar();
    }

    // Ø³Ø§Ø®Øª HTML Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø±Ø¯ÛŒÙ
    function createRowHTML(name, percent) {
        const div = document.createElement('div');
        div.className = 'budget-item';
        div.innerHTML = `
            <input type="text" class="item-name" value="${name}" placeholder="Ù†Ø§Ù… Ù‡Ø²ÛŒÙ†Ù‡">
            <div class="percent-input-group">
                <input type="tel" class="percent-input" value="${percent}" oninput="handlePercentChange(this)" placeholder="0">
                <span class="percent-symbol">%</span>
            </div>
            <div class="amount-display">0 ${currentCurrency}</div>
            <button class="btn-remove" onclick="removeRow(this)"><i class="fas fa-trash-alt"></i></button>
        `;
        itemsContainer.appendChild(div);
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ø¯ÛŒØ¯
    function addRow() {
        createRowHTML("Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯", 0);
        updatePercentBar();
    }

    // Ø­Ø°Ù Ø±Ø¯ÛŒÙ
    function removeRow(btn) {
        btn.parentElement.remove();
        updatePercentBar();
        calculateAll();
    }

    // Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ÛŒ Ù¾ÙˆÙ„ Ø§ØµÙ„ÛŒ
    function handleMainInput(input) {
        // Û±. Ø­Ø°Ù Ú©Ø§Ù…Ø§Ù‡Ø§ Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
        let rawValue = toEnglishDigits(input.value).replace(/,/g, '');
        
        // Û². Ø§Ú¯Ø± Ø¹Ø¯Ø¯ Ù†ÛŒØ³ØªØŒ Ù¾Ø§Ú© Ú©Ù†
        if (isNaN(rawValue) || rawValue === '') {
            calculateAll(); // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ù…Ù‚Ø§Ø¯ÛŒØ±
            return;
        }

        // Û³. ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ø¯Ø¯ Ø¯Ø± Ø§ÛŒÙ†Ù¾ÙˆØª
        input.value = parseInt(rawValue).toLocaleString('en-US');
        
        // Û´. Ø§Ù†Ø¬Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø§Øª
        calculateAll();
    }

    // Ù…Ø¯ÛŒØ±ÛŒØª ØªØºÛŒÛŒØ± Ø¯Ø±ØµØ¯Ù‡Ø§
    function handlePercentChange(input) {
        let val = toEnglishDigits(input.value);
        // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙˆØ±ÙˆØ¯ Ø­Ø±ÙˆÙ
        if(isNaN(val)) input.value = 0;
        
        updatePercentBar();
        calculateAll();
    }

    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±ØµØ¯
    function updatePercentBar() {
        let totalPercent = 0;
        const rows = document.querySelectorAll('.budget-item');
        
        rows.forEach(row => {
            let pVal = row.querySelector('.percent-input').value;
            totalPercent += parseFloat(toEnglishDigits(pVal)) || 0;
        });

        const bar = document.getElementById('progressBar');
        const text = document.getElementById('percentText');
        const msg = document.getElementById('statusMessage');

        // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¹Ø±Ø¶ Ø¨Ø§Ø± Ø¨Ù‡ Û±Û°Û° (Ø¨Ø±Ø§ÛŒ Ú¯Ø±Ø§ÙÛŒÚ©)
        let visualPercent = totalPercent > 100 ? 100 : totalPercent;
        bar.style.width = visualPercent + '%';
        text.innerText = `Ø¬Ù…Ø¹ Ø¯Ø±ØµØ¯: ${toPersianDigits(totalPercent)}Ùª`;

        if (totalPercent === 100) {
            bar.style.backgroundColor = 'var(--success)';
            msg.innerText = "âœ… ØªÚ©Ù…ÛŒÙ„ Ùˆ Ø¯Ù‚ÛŒÙ‚";
            msg.style.color = 'var(--success)';
        } else if (totalPercent > 100) {
            bar.style.backgroundColor = 'var(--danger)';
            msg.innerText = `âš ï¸ ${toPersianDigits(totalPercent - 100)}Ùª Ø§Ø¶Ø§ÙÙ‡ Ø§Ø³Øª!`;
            msg.style.color = 'var(--danger)';
        } else {
            bar.style.backgroundColor = 'var(--warning)';
            msg.innerText = `ğŸ”µ ${toPersianDigits(100 - totalPercent)}Ùª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡`;
            msg.style.color = 'var(--text-dark)';
        }
    }

    // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡
    function calculateAll() {
        const totalInput = document.getElementById('totalAmount');
        const rawTotal = parseFloat(toEnglishDigits(totalInput.value).replace(/,/g, '')) || 0;
        
        currentCurrency = currencySelector.value;
        const rows = document.querySelectorAll('.budget-item');

        rows.forEach(row => {
            const pInput = row.querySelector('.percent-input');
            const resultBox = row.querySelector('.amount-display');
            
            const percent = parseFloat(toEnglishDigits(pInput.value)) || 0;
            
            // ÙØ±Ù…ÙˆÙ„ Ù…Ø­Ø§Ø³Ø¨Ù‡
            const share = (rawTotal * percent) / 100;
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¹Ø¯Ø¯ ÙØ§Ø±Ø³ÛŒ Ø´Ø¯Ù‡
            resultBox.innerText = toPersianDigits(formatMoney(share)) + " " + currentCurrency;
        });
    }

    // Ø¨Ø§Ø²Ø®ÙˆØ§Ù†ÛŒ ÙˆØ§Ø­Ø¯ Ù¾ÙˆÙ„
    function reCalculate() {
        calculateAll();
    }

    // Ø§Ø¬Ø±Ø§
    init();

</script>

</body>
</html>
